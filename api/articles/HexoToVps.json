{"title":"Hexo部署到Vultr Vps+宝塔面板","slug":"HexoToVps","date":"2020-02-23T06:36:59.000Z","updated":"2020-08-11T06:03:00.000Z","comments":true,"path":"api/articles/HexoToVps.json","excerpt":"Hexo托管在github太慢？那就部署到服务器","covers":["https://img-pg.52wmtg.com/hc/hexo-website.png","https://img-pg.52wmtg.com/hc/hexo_config.png"],"content":"<center>Hexo托管在github太慢？那就部署到服务器</center>\n\n<span id=\"more\"></span>\n\n<h3 id=\"安装宝塔\"><a href=\"#安装宝塔\" class=\"headerlink\" title=\"安装宝塔\"></a>安装宝塔</h3><p><a href=\"http://bt.cn/\">http://bt.cn</a></p>\n<h3 id=\"安装git\"><a href=\"#安装git\" class=\"headerlink\" title=\"安装git\"></a>安装git</h3><p>当然以下操作都是在你远程服务器上操作的</p>\n<p>centos 输入以下命令</p>\n<p>git –version // 如无，则安装</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install curl-devel expat-devel gettext-devel openssl-devel zlib-devel perl-devel</span><br><span class=\"line\">yum install -y git</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"配置git仓库\"><a href=\"#配置git仓库\" class=\"headerlink\" title=\"配置git仓库\"></a>配置git仓库</h3><p>创建用户git并配置仓库</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">useradd git</span><br><span class=\"line\">passwd git <span class=\"comment\">// 设置密码</span></span><br><span class=\"line\">su git <span class=\"comment\">// 这步很重要，不切换用户后面会很麻烦</span></span><br><span class=\"line\">mkdir -p /www/wwwroot/hexoblog <span class=\"comment\">// 项目存在的真实目录,由于需要用到宝塔 我们把博客地址放到宝塔网站地址下</span></span><br></pre></td></tr></table></figure>\n\n<p>如果上面mkdir出错是因为我们没有把git用户添加到sudoers中<br>做如下操作</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo su <span class=\"comment\">//输入密码进入root用户</span></span><br><span class=\"line\">cd /etc/</span><br><span class=\"line\">vim sudoers</span><br></pre></td></tr></table></figure>\n\n<p>找到root ALL=(ALL) ALL<br>在下面添加</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git ALL=(ALL)   ALL</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"注意对齐\"><a href=\"#注意对齐\" class=\"headerlink\" title=\"注意对齐\"></a><strong>注意对齐</strong></h3><p>然后进入git用户执行如下命令</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">su git</span><br><span class=\"line\">sudo mkdir -p /www/wwwroot/hexoblog</span><br><span class=\"line\">cd /home/git/</span><br><span class=\"line\">mkdir repos &amp;&amp; cd repos</span><br><span class=\"line\">git init --bare hexoblog.git</span><br><span class=\"line\">cd hexoblog.git/hooks</span><br><span class=\"line\">vi post-receive <span class=\"comment\">// 创建hook钩子函数，输入了内容如下（原理可以参考上面的链接)</span></span><br></pre></td></tr></table></figure>\n\n<p>输入如下内容</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!/bin/sh</span><br><span class=\"line\">git --work-tree=/www/wwwroot/hexoblog --git-dir=/home/git/repos/hexoblog.git checkout -f</span><br></pre></td></tr></table></figure>\n\n<p>添加完毕后修改权限，执行如下命令</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chmod +x post-receive</span><br><span class=\"line\"><span class=\"built_in\">exit</span> <span class=\"comment\">// 退出到 root 登录</span></span><br><span class=\"line\">chown -R git:git /home/git/repos/hexoblog.git <span class=\"comment\">// 添加权限</span></span><br></pre></td></tr></table></figure>\n\n<p>测试git仓库是否可用，另找空白文件夹，执行如下命令<br>注意这一步在自己的电脑上测试</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git clone git@server_ip:/home/git/repos/hexoblog.git</span><br></pre></td></tr></table></figure>\n\n<p>如果能把空仓库拉下来，就说明 git 仓库搭建成功了<br>当然你会提示你拉下来的是空仓库</p>\n<h3 id=\"本地电脑设置\"><a href=\"#本地电脑设置\" class=\"headerlink\" title=\"本地电脑设置\"></a>本地电脑设置</h3><p>建立ssh信任关系，在本地电脑，执行如下命令</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ssh-copy-id -i ~/.ssh/id_rsa.pub git@server_ip</span><br><span class=\"line\">ssh git@server_ip <span class=\"comment\">// 测试能否登录</span></span><br></pre></td></tr></table></figure>\n\n<p>为了安全起见禁用git用户的 shell 登录权限，从而只能用git clone,git push等登录，执行如下命令</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat /etc/shells <span class=\"comment\">// 查看`git-shell`是否在登录方式里面，有则跳过</span></span><br><span class=\"line\">which git-shell <span class=\"comment\">// 查看是否安装</span></span><br><span class=\"line\">vi /etc/shells</span><br></pre></td></tr></table></figure>\n\n<p>添加上2步显示出来的路劲，通常在 /usr/bin/git-shell</p>\n<p>修改/etc/passwd中的权限，将原来的</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git:x:<span class=\"number\">1002</span>:<span class=\"number\">1002</span>::/home/git:/bin/bash  #也许你的不是这个</span><br></pre></td></tr></table></figure>\n\n<p>修改为</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git:x:<span class=\"number\">1000</span>:<span class=\"number\">1000</span>::/home/git:/usr/bin/git-shell  #修改为这个</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"宝塔面板设置\"><a href=\"#宝塔面板设置\" class=\"headerlink\" title=\"宝塔面板设置\"></a>宝塔面板设置</h3><p>添加站点</p>\n<p><img src=\"https://img-pg.52wmtg.com/hc/hexo-website.png\" alt=\"hexo website\"></p>\n<h3 id=\"Hexo配置文件设置\"><a href=\"#Hexo配置文件设置\" class=\"headerlink\" title=\"Hexo配置文件设置\"></a>Hexo配置文件设置</h3><p><img src=\"https://img-pg.52wmtg.com/hc/hexo_config.png\" alt=\"hexo config\"></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">deploy:</span><br><span class=\"line\">  type: &#39;git&#39;</span><br><span class=\"line\">  #repo: https:&#x2F;&#x2F;github.com&#x2F;yourname&#x2F;yourname.github.io.git</span><br><span class=\"line\">  repo: git@yourIP:&#x2F;home&#x2F;git&#x2F;repos&#x2F;hexoblog.git</span><br><span class=\"line\">  branch: master</span><br></pre></td></tr></table></figure>\n\n<p>push到vps git仓库</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hexo clean &amp;&amp; hexo d -g</span><br><span class=\"line\">出现这个错误</span><br><span class=\"line\">ERROR Deployer <span class=\"keyword\">not</span> found: git</span><br><span class=\"line\">执行</span><br><span class=\"line\">npm install --save hexo-deployer-git</span><br></pre></td></tr></table></figure>\n\n<p>去浏览器输入你的域名访问网站试试吧！</p>\n<h3 id=\"其他问题\"><a href=\"#其他问题\" class=\"headerlink\" title=\"其他问题\"></a>其他问题</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Could not chdir to home directory &#x2F;home&#x2F;git: Permission denied</span><br><span class=\"line\">fatal: &#39;&#x2F;home&#x2F;git&#x2F;repos&#x2F;hexoblog.git&#39; does not appear to be a git repository</span><br><span class=\"line\">fatal: Could not read from remote repository.</span><br><span class=\"line\"></span><br><span class=\"line\">Please make sure you have the correct access rights</span><br><span class=\"line\">and the repository exists.</span><br><span class=\"line\">FATAL Something&#39;s wrong. Maybe you can find the solution here: https:&#x2F;&#x2F;hexo.io&#x2F;docs&#x2F;troubleshooting.html</span><br><span class=\"line\">Error: Spawn failed</span><br><span class=\"line\">    at ChildProcess.&lt;anonymous&gt; (D:\\Documents\\site\\hexoblog\\node_modules\\hexo-util\\lib\\spawn.js:51:21)</span><br><span class=\"line\">    at ChildProcess.emit (events.js:223:5)</span><br><span class=\"line\">    at ChildProcess.cp.emit (D:\\Documents\\site\\hexoblog\\node_modules\\cross-spawn\\lib\\enoent.js:34:29)</span><br><span class=\"line\">    at Process.ChildProcess._handle.onexit (internal&#x2F;child_process.js:272:12)</span><br></pre></td></tr></table></figure>\n\n<p>这个提示是权限问题，在宝塔面板，文件找到根目录/home/git文件夹，将权限改为www即可。</p>\n<p>本文参考资料：<br><a href=\"https://rowe98.github.io/2019/05/14/gitRepoBlog/\">https://rowe98.github.io/2019/05/14/gitRepoBlog/</a><br><a href=\"https://0727.site/2019/11/22/%E7%94%A8%E5%AE%9D%E5%A1%94%E9%9D%A2%E6%9D%BF%E5%B0%86hexo%E5%8D%9A%E5%AE%A2%E9%83%A8%E7%BD%B2%E5%88%B0%E9%98%BF%E9%87%8C%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8/\">https://0727.site/2019/11/22/%E7%94%A8%E5%AE%9D%E5%A1%94%E9%9D%A2%E6%9D%BF%E5%B0%86hexo%E5%8D%9A%E5%AE%A2%E9%83%A8%E7%BD%B2%E5%88%B0%E9%98%BF%E9%87%8C%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8/</a><br><a href=\"https://www.cnblogs.com/aisowe/p/11886386.html\">https://www.cnblogs.com/aisowe/p/11886386.html</a><br><a href=\"http://blog.chinaunix.net/uid-26284395-id-2949145.html\">http://blog.chinaunix.net/uid-26284395-id-2949145.html</a><br><a href=\"https://blog.csdn.net/node_One/article/details/103213995\">https://blog.csdn.net/node_One/article/details/103213995</a></p>\n","categories":[],"tags":[{"name":"网站建设","path":"api/tags/网站建设.json"}]}